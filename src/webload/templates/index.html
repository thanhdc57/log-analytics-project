<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Log Load Scenarios</title>
    <style>
      body { font-family: Arial, sans-serif; margin: 24px; }
      .card { border: 1px solid #ddd; border-radius: 8px; padding: 16px; margin-bottom: 12px; }
      .row { display: flex; gap: 12px; flex-wrap: wrap; }
      button { padding: 8px 12px; cursor: pointer; }
      .status { margin-top: 16px; font-weight: bold; }
    </style>
  </head>
  <body>
    <h1>Log Load Scenarios</h1>
    <p>Trigger scenarios to generate logs into Kafka.</p>

    <div class="row">
      {% for name, cfg in scenarios.items() %}
      <div class="card">
        <h3>{{ name }}</h3>
        <div>Rate: {{ cfg.rate }} logs/s</div>
        <div>Duration: {{ cfg.duration }} s</div>
        <button onclick="startScenario('{{ name }}')">Start</button>
      </div>
      {% endfor %}
    </div>

    <div class="card">
      <button onclick="stopScenario()">Stop</button>
      <div class="status" id="status">Status: idle</div>
    </div>

    <script>
      async function startScenario(name) {
        const res = await fetch(`/start/${name}`, { method: 'POST' });
        const data = await res.json();
        if (data.error) alert(data.error);
        await refreshStatus();
      }
      async function stopScenario() {
        await fetch('/stop', { method: 'POST' });
        await refreshStatus();
      }
      async function refreshStatus() {
        const res = await fetch('/status');
        const data = await res.json();
        const el = document.getElementById('status');
        if (!data.running) {
          el.textContent = 'Status: idle';
        } else {
          el.textContent = `Status: running ${data.scenario} (${data.rate} logs/s)`;
        }
      }
      setInterval(refreshStatus, 2000);
      refreshStatus();
    </script>
  </body>
</html>